<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Visualizaci√≥n de Grupos | RT v1.0</title>
  <!-- DataTables CSS -->
  <link
    rel="stylesheet"
    href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css"
  >
  <!-- Tu CSS global -->
  <link rel="stylesheet" href="css/estilos.css">
  <style>
    /* Ajustes r√°pidos para el buscador encima */
    #buscador {
      margin-bottom: 1rem;
      padding: .5rem;
      width: 100%;
      max-width: 400px;
      font-size: 1rem;
    }
    .filtro-col {
      width: 100%;
      padding: .25rem;
    }
  </style>
</head>
<body>
  <!-- === Header replicado === -->
  <header>
    <div class="logo"> <!-- tu logo --> </div>
    <div class="titulo">SISTEMA DE OPERACIONES RT v1.0</div>
    <div class="usuario">Usuario conectado: <!-- nombre --> </div>
    <nav>
      <a href="index.html">üè†</a>
      <a href="#" onclick="location.reload()">üîÑ</a>
      <a href="javascript:history.back()">‚¨ÖÔ∏è</a>
      <a href="logout">‚èèÔ∏è</a>
    </nav>
  </header>

  <main>
    <h1>Visualizaci√≥n de Grupos</h1>

    <!-- Buscador global -->
    <input
      type="text"
      id="buscador"
      placeholder="Buscar en cualquier columna‚Ä¶"
    >

    <!-- Aqu√≠ opcionales selects para filtrar por columna -->
    <div id="filtros" style="display:flex; gap:1rem; flex-wrap:wrap; margin-bottom:1rem;">
      <select id="filtroDestino" class="filtro-col">
        <option value="">Todos los destinos</option>
      </select>
      <select id="filtroAno" class="filtro-col">
        <option value="">Todos los a√±os</option>
      </select>
      <!-- a√±ade m√°s selects si quieres -->
    </div>

    <!-- Tabla DataTables -->
    <table id="tablaGrupos" class="display" style="width:100%">
      <thead>
        <tr>
          <th>Num Negocio</th>
          <th>Grupo</th>
          <th>Pax Total</th>
          <th>Colegio</th>
          <th>Curso</th>
          <th>A√±o Viaje</th>
          <th>Destino</th>
          <th>Programa</th>
          <th>Hotel</th>
          <th>Asist. Viajes</th>
          <th>Autorizaci√≥n</th>
          <th>Fecha Viaje</th>
          <th>Obs.</th>
          <th>Versi√≥n</th>
          <th>Creado Por</th>
          <th>Fecha Creaci√≥n</th>
          <th>Inicio</th>
          <th>Fin</th>
          <th>Adultos</th>
          <th>Estudiantes</th>
          <th>Transporte</th>
          <th>Ciudades</th>
          <th>Hoteles</th>
          <th>Tramos</th>
          <th>Obs. Log√≠st.</th>
        </tr>
      </thead>
      <tbody>
        <!-- se llena din√°micamente -->
      </tbody>
    </table>
  </main>

  <!-- jQuery + DataTables JS -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script
    src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"
  ></script>
  <script>
    let tabla;

    // Campos a usar
    const campos = [
      'numeroNegocio','nombreGrupo','cantidadgrupo','colegio','curso','anoViaje',
      'destino','programa','hotel','asistenciaEnViajes','autorizacion',
      'fechaDeViaje','observaciones','versionFicha','creadoPor','fechaCreacion',
      'fechaInicio','fechaFin','adultos','estudiantes','transporte',
      'ciudades','hoteles','tramos','observacionesLogisticas'
    ];

    // 1. Traer datos de tu Google Script
    fetch('https://script.google.com/macros/s/AKfycbzr12TXE8-lFd86P1yK_yRSVyyFFSuUnAHY_jOefJHYQZCQ5yuQGQsoBP2OWh699K22/exec')
      .then(res => res.json())
      .then(json => {
        const datos = json.valores; // asume un array de objetos
        poblarTabla(datos);
        poblarFiltros(datos);
      })
      .catch(err => console.error(err));

    function poblarTabla(datos) {
      const $tbody = $('#tablaGrupos tbody');
      datos.forEach(row => {
        const $tr = $('<tr>');
        campos.forEach(c => {
          $tr.append( $('<td>').text(row[c] ?? '') );
        });
        $tbody.append($tr);
      });

      // 2. Inicializar DataTable
      tabla = $('#tablaGrupos').DataTable({
        language: { url: 'https://cdn.datatables.net/plug-ins/1.13.4/i18n/es-ES.json' },
        dom: 'lrtip',             // l = length, r = processing, t = table, i = info, p = paging. Quitamos la b√∫squeda por defecto ('f')
        pageLength: 10,
        order: [[5, 'desc']],     // orden por a√±oViaje descendente
      });

      // 3. Buscador global personalizado
      $('#buscador').on('input', function() {
        tabla.search(this.value).draw();
      });
    }

    function poblarFiltros(datos) {
      // ejemplo: √∫nicos destinos y a√±os
      const destinos = [...new Set(datos.map(r => r.destino))].sort();
      destinos.forEach(d => $('#filtroDestino').append(`<option>${d}</option>`));

      const anos = [...new Set(datos.map(r => r.anoViaje))].sort();
      anos.forEach(a => $('#filtroAno').append(`<option>${a}</option>`));

      // listeners de filtros por columna
      $('#filtroDestino').on('change', function() {
        tabla.column(6)  // la columna destino es √≠ndice 6 (0-based)
             .search(this.value)
             .draw();
      });
      $('#filtroAno').on('change', function() {
        tabla.column(5)  // a√±oViaje es columna 5
             .search(this.value)
             .draw();
      });
    }
  </script>
</body>
</html>
