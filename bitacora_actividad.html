<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bitácora por actividad | RT</title>

  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
  <link rel="stylesheet" href="estilos.css" />
  <link rel="icon" type="image/png" href="Logo Raitrai.png" />

  <style>
    /* SOLO ajustes puntuales de layout para esta página, manteniendo tu estética */
    .page { padding: 1rem 1.2rem; }
    .toolbar { margin: .8rem 0 1rem; }
    .toolbar .tag { font-size: .85rem; opacity: .8; }
    .toolbar input,
    .toolbar select,
    .toolbar button {
      padding:.45rem .55rem;
      border:1px solid #ddd;
      border-radius:8px;
      font-size:.9rem;
      width:100%;
      max-width:100%;
      box-sizing:border-box;
    }

    @media (min-width: 900px) {
      .toolbar { flex-direction: row; align-items:center; }
      .toolbar input { flex: 1 1 0; }
      .toolbar button { flex: 0 0 auto; width: auto; }
      .toolbar .tag { flex: 0 0 auto; width:auto; }
    }

    /* Tabla resultados: misma clase finanzas */
    table.finanzas { width:100%; max-width:100%; box-sizing:border-box; }

    /* Contadores tipo resumen (igual espíritu que tus stat-card, pero simple) */
    .kpi-row{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(180px,1fr));
      gap: .8rem;
      margin-top: .6rem;
    }
    .kpi{
      background:#f9fafb;
      border:1px solid #e5e7eb;
      border-radius:10px;
      padding:.8rem 1rem;
      text-align:center;
    }
    .kpi .label{
      font-size:.8rem;
      text-transform:uppercase;
      color:#6b7280;
      margin-bottom:.25rem;
      font-weight:600;
    }
    .kpi .value{
      font-size:1.3rem;
      font-weight:700;
      font-family:ui-monospace,monospace;
    }

    .hint { font-size:.85rem; opacity:.75; margin-top:.35rem; }
    .mono { font-family:ui-monospace, Menlo, Consolas, "Courier New", monospace; }

    /* En mobile escondemos autor si quieres (opcional) */
    @media (max-width: 900px) {
      table.finanzas td:nth-child(6),
      table.finanzas th:nth-child(6) { display:none; }
    }
  </style>
</head>

<body>
  <div id="encabezado"></div>

  <div class="page" id="bitacoraRoot" data-mode="sistema">
    <h2 style="margin:.4rem 0 0;">BITÁCORA POR ACTIVIDAD</h2>
    <div class="hint">
      - Si eliges <b>Grupo</b>: muestra <b>todas las actividades</b> + sus comentarios (bitácora) en rango.<br/>
      - Si eliges <b>Destino</b>: muestra <b>todas las actividades</b> + comentarios de <b>todos los grupos</b> de ese destino.
    </div>

    <!-- Filtros -->
    <div class="toolbar">
      <input id="fDestino" type="text" placeholder="DESTINO (opcional, recomendado)" list="dl-destinos" />
      <datalist id="dl-destinos"></datalist>

      <input id="fCoord" type="email" placeholder="COORDINADOR(A) (opcional)" list="dl-coords" />
      <datalist id="dl-coords"></datalist>

      <input id="fGrupo" type="text" placeholder="GRUPO ESPECÍFICO (opcional)" list="dl-grupos" />
      <datalist id="dl-grupos"></datalist>

      <button id="btnLoadActs" class="primary">CARGAR ACTIVIDADES</button>
      <button id="btnCargar" class="primary">CARGAR BITÁCORA</button>
      <button id="btnLimpiar" class="primary">LIMPIAR</button>

      <span class="tag" id="status">Listo.</span>
    </div>

    <div class="toolbar">
      <input id="fActividad" class="mono" type="text" placeholder="ACTIVIDAD (opcional, activityId)" list="dl-actividades" />
      <datalist id="dl-actividades"></datalist>

      <input id="fDesde" type="date" />
      <input id="fHasta" type="date" />

      <input id="fBuscarTxt" type="text" placeholder="BUSCAR TEXTO (en resultados)" />

      <span class="tag" id="actCount">Actividades sugeridas: 0</span>
      <span class="tag" id="modeHint">Modo: —</span>
    </div>

    <!-- KPIs -->
    <div class="card">
      <h3>Resumen</h3>
      <div class="kpi-row">
        <div class="kpi">
          <div class="label">Grupos considerados</div>
          <div class="value" id="kpiGrupos">—</div>
        </div>
        <div class="kpi">
          <div class="label">Días consultados</div>
          <div class="value" id="kpiDias">—</div>
        </div>
        <div class="kpi">
          <div class="label">Entradas encontradas</div>
          <div class="value" id="kpiEntradas">0</div>
        </div>
      </div>
    </div>

    <!-- Resultados -->
    <div class="card">
      <h3>Resultados</h3>
      <div class="toolbar" style="margin:.4rem 0 0;">
        <span class="tag" id="resultInfo">Sin resultados.</span>
      </div>

      <table class="finanzas" id="tbl">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Hora</th>
            <th>Grupo</th>
            <th>Actividad</th>
            <th>Texto</th>
            <th>Autor</th>
          </tr>
        </thead>
        <tbody>
          <tr><td colspan="6" class="muted">Sin resultados para ese criterio.</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Carga encabezado + firebase + lógica -->
  <script type="module">
    (async () => {
      try {
        const html = await (await fetch('encabezado.html')).text().catch(()=> '');
        document.getElementById('encabezado').innerHTML = html || '';
      } catch (_) {}

      await import('./firebase-init.js'); // inicializa Firebase
      await import('./script.js');        // reloj/usuario del encabezado
      await import('./bitacora_actividad.js'); // lógica bitácora
      console.log('✅ bitacora_actividad.js cargado');
    })();
  </script>

  <script type="module" src="firebase-init.js" defer></script>
</body>
</html>
