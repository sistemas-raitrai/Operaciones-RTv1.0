<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Rendiciones Coordinadores · RT</title>

  <!-- Favicon (ajusta si tu ruta es distinta) -->
  <link rel="icon" type="image/png" href="RaitraiLogo.png"/>

  <!-- ✅ Estilos globales del sistema (tu estética común) -->
  <link rel="stylesheet" href="./style.css"/>

  <!-- (Opcional) Si tienes un CSS específico para esta pantalla -->
  <!-- <link rel="stylesheet" href="./rendiciones_coordinadores.css"/> -->

  <!-- ✅ Fix mínimo de layout (solo si no quieres tocar style.css).
       Si ya lo agregarás en style.css, puedes borrar este <style>. -->
  <style>
    /* espacio para header común si es fixed/sticky */
    main.page{ padding-top: 72px; }

    /* panel de filtros responsive para evitar solapes */
    .filters-panel{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap:12px;
      align-items:end;
    }
    .filters-panel .field{ display:flex; flex-direction:column; gap:6px; }
    .filters-panel input, .filters-panel select{
      width:100%;
      min-width:0;
    }
    .filters-actions{
      display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-start;
    }

    /* wrappers */
    .wrap{ max-width: 1200px; margin: 0 auto; padding: 18px 14px; }
    .card{ border: 1px solid var(--border, #d1d5db); background: var(--card, #fff); border-radius: 12px; padding: 14px; }
    .muted{ color: var(--muted, #6b7280); }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }

    /* tablas */
    table{ width:100%; border-collapse:collapse; }
    th, td{ border-bottom:1px solid var(--border, #d1d5db); padding:10px 8px; vertical-align:top; }
    thead th{ font-weight:600; text-align:left; }
    .num{ text-align:right; white-space:nowrap; }

    /* botones (usa tus clases si ya existen en style.css) */
    .btn-row{ display:flex; gap:10px; flex-wrap:wrap; }
  </style>
</head>

<body>
  <!-- ✅ ENCABEZADO COMÚN (slot) -->
  <div id="appHeader"></div>

  <main class="page">
    <div class="wrap">

      <!-- =========================
           TÍTULO / INFO
      ========================== -->
      <header style="margin-bottom:14px;">
        <h1 style="margin:0 0 6px;">Rendición de gastos por grupo/coordinador</h1>
        <div class="muted" id="pagInfo">Selecciona filtros y carga los datos.</div>
      </header>

      <!-- =========================
           FILTROS
      ========================== -->
      <section class="card" style="margin-bottom:14px;">
        <h2 style="margin:0 0 10px; font-size:14px;">Filtros</h2>

        <div class="filters-panel" id="panelFiltros">
          <!-- Coordinador -->
          <div class="field">
            <label for="filtroCoord" class="muted" style="font-size:12px;">Coordinador(a) (email)</label>
            <input
              id="filtroCoord"
              class="input-field"
              type="text"
              placeholder="ej: loreto.leiva@..."
              list="dl-coords"
              autocomplete="off"
            />
            <datalist id="dl-coords"></datalist>
          </div>

          <!-- Grupo (ID / Número negocio) -->
          <div class="field">
            <label for="filtroGrupo" class="muted" style="font-size:12px;">Grupo (ID / Nº negocio)</label>
            <input
              id="filtroGrupo"
              class="input-field"
              type="text"
              placeholder="ej: 1492 o id del doc"
              list="dl-grupos"
              autocomplete="off"
            />
            <datalist id="dl-grupos"></datalist>
          </div>

          <!-- Nombre de grupo -->
          <div class="field">
            <label for="filtroNombreGrupo" class="muted" style="font-size:12px;">Nombre de grupo</label>
            <input
              id="filtroNombreGrupo"
              class="input-field"
              type="text"
              placeholder="ej: CASTELGANDOLFO 3A"
              list="dl-grupos-nombre"
              autocomplete="off"
            />
            <datalist id="dl-grupos-nombre"></datalist>
          </div>

          <!-- Acciones -->
          <div class="field">
            <div class="muted" style="font-size:12px;">Acciones</div>
            <div class="filters-actions">
              <button id="btnCargar" type="button" class="btn btn-primary">Cargar datos</button>
              <button id="btnLimpiarFiltros" type="button" class="btn btn-ghost">Limpiar</button>
            </div>
          </div>
        </div>
      </section>

      <!-- =========================
           INFO GRUPO (CARD)
      ========================== -->
      <section class="card" style="margin-bottom:14px;">
        <h2 style="margin:0 0 10px; font-size:14px;">Información del grupo</h2>

        <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:10px;">
          <div><div class="muted" style="font-size:12px;">Grupo</div><div id="infoGrupo">—</div></div>
          <div><div class="muted" style="font-size:12px;">Coordinador(a)</div><div id="infoCoord">—</div></div>
          <div><div class="muted" style="font-size:12px;">Destino</div><div id="infoDestino">—</div></div>
          <div><div class="muted" style="font-size:12px;">Pax</div><div id="infoPax">—</div></div>
          <div><div class="muted" style="font-size:12px;">Programa</div><div id="infoPrograma">—</div></div>
          <div><div class="muted" style="font-size:12px;">Fechas</div><div id="infoFechas">—</div></div>
        </div>
      </section>

      <!-- =========================
           TABLA GASTOS
      ========================== -->
      <section class="card" style="margin-bottom:14px;">
        <div style="display:flex; justify-content:space-between; align-items:baseline; gap:10px; flex-wrap:wrap;">
          <h2 style="margin:0; font-size:14px;">Gastos</h2>
          <div id="resumenTabla" class="muted">—</div>
        </div>

        <div style="overflow:auto; margin-top:10px;">
          <table id="tblGastos">
            <thead>
              <tr>
                <th style="min-width:90px;">Fecha</th>
                <th style="min-width:220px;">Asunto</th>
                <th style="min-width:180px;">Autor</th>
                <th style="min-width:70px;">Moneda</th>
                <th style="min-width:120px;" class="num">Monto</th>
                <th style="min-width:180px;">Monto aprobado</th>
                <th style="min-width:190px;">Categoría</th>
                <th style="min-width:90px;">Comprobante</th>
                <th style="min-width:70px;">OK</th>
              </tr>
            </thead>
            <tbody>
              <tr><td colspan="9"><div class="muted">Sin datos aún.</div></td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- =========================
           DESCUENTOS
      ========================== -->
      <section class="card" style="margin-bottom:14px;">
        <div style="display:flex; justify-content:space-between; align-items:baseline; gap:10px; flex-wrap:wrap;">
          <h2 style="margin:0; font-size:14px;">Descuentos</h2>
          <div class="btn-row">
            <button id="btnAgregarDesc" type="button" class="btn btn-primary">+ Agregar descuento</button>
          </div>
        </div>

        <div style="display:grid; grid-template-columns: 1fr 1fr auto; gap:10px; margin-top:10px; align-items:end;">
          <div>
            <div class="muted" style="font-size:12px;">Monto (CLP)</div>
            <input id="nuevoDescMonto" type="number" class="input-field mono" min="0" step="1000" placeholder="ej: 15000"/>
          </div>
          <div>
            <div class="muted" style="font-size:12px;">Motivo</div>
            <input id="nuevoDescMotivo" type="text" class="input-field" placeholder="ej: Ajuste caja chica"/>
          </div>
          <div>
            <div class="muted" style="font-size:12px;">&nbsp;</div>
            <button id="btnAgregarDesc2" type="button" class="btn btn-ghost" style="display:none;">(no usar)</button>
          </div>
        </div>

        <div style="overflow:auto; margin-top:10px;">
          <table id="tblDescuentos">
            <thead>
              <tr>
                <th>Motivo</th>
                <th class="num" style="min-width:140px;">Monto (CLP)</th>
                <th style="min-width:120px;">Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr><td colspan="3"><div class="muted">Sin descuentos registrados.</div></td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- =========================
           DOCUMENTOS / RESUMEN
      ========================== -->
      <section class="card" style="margin-bottom:14px;">
        <h2 style="margin:0 0 10px; font-size:14px;">Resumen financiero</h2>

        <!-- Bloques CLP (los IDs que tu JS usa) -->
        <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:10px;">
          <div><div class="muted" style="font-size:12px;">Abonos (CLP)</div><div id="sumAbonos" class="mono">—</div></div>
          <div><div class="muted" style="font-size:12px;">Gastos aprobados (CLP)</div><div id="sumGastos" class="mono">—</div></div>
          <div><div class="muted" style="font-size:12px;">Descuentos (CLP)</div><div id="sumDescuentos" class="mono">—</div></div>
          <div><div class="muted" style="font-size:12px;">Gastos netos (CLP)</div><div id="sumGastosNetos" class="mono">—</div></div>
          <div><div class="muted" style="font-size:12px;">Saldo esperado (CLP)</div><div id="sumSaldoEsperado" class="mono">—</div></div>
          <div><div class="muted" style="font-size:12px;">Devuelto (CLP)</div><div id="sumDevuelto" class="mono">—</div></div>
          <div><div class="muted" style="font-size:12px;">Resultado (CLP)</div><div id="sumResultado">—</div></div>
        </div>

        <hr style="border:none;border-top:1px solid var(--border,#d1d5db); margin:14px 0;"/>

        <!-- (Opcional) USD: tu JS los llena si existen -->
        <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:10px;">
          <div><div class="muted" style="font-size:12px;">Abonos (USD)</div><div id="sumAbonosUSD" class="mono">—</div></div>
          <div><div class="muted" style="font-size:12px;">Gastos aprobados (USD)</div><div id="sumGastosUSD" class="mono">—</div></div>
          <div><div class="muted" style="font-size:12px;">Gastos netos (USD)</div><div id="sumGastosNetosUSD" class="mono">—</div></div>
          <div><div class="muted" style="font-size:12px;">Saldo esperado (USD)</div><div id="sumSaldoEsperadoUSD" class="mono">—</div></div>
          <div><div class="muted" style="font-size:12px;">Devuelto (USD)</div><div id="sumDevueltoUSD" class="mono">—</div></div>
          <div><div class="muted" style="font-size:12px;">Resultado (USD)</div><div id="sumResultadoUSD">—</div></div>
        </div>
      </section>

      <!-- =========================
           ESTADO DOCS
      ========================== -->
      <section class="card" style="margin-bottom:14px;">
        <div style="display:flex; justify-content:space-between; align-items:baseline; gap:10px; flex-wrap:wrap;">
          <h2 style="margin:0; font-size:14px;">Estado de documentos</h2>
          <button id="btnGuardarDocs" type="button" class="btn btn-primary">Guardar estado</button>
        </div>

        <div style="overflow:auto; margin-top:10px;">
          <table>
            <thead>
              <tr>
                <th>Documento</th>
                <th>Link</th>
                <th style="min-width:180px;">OK</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td id="celdaEstadoBoleta">Boleta / Doc SII</td>
                <td><a id="linkBoleta" class="link-doc" target="_blank" rel="noopener">PENDIENTE</a></td>
                <td><label style="display:flex; gap:8px; align-items:center;"><input id="chkBoletaOk" type="checkbox"/> Revisado</label></td>
              </tr>

              <tr>
                <td id="celdaEstadoTransf">Comprobante transferencia CLP</td>
                <td><a id="linkComprobante" class="link-doc" target="_blank" rel="noopener">PENDIENTE</a></td>
                <td>
                  <div style="display:flex; flex-direction:column; gap:8px;">
                    <label style="display:flex; gap:8px; align-items:center;">
                      <input id="chkComprobanteOk" type="checkbox"/> Revisado
                    </label>
                    <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
                      <span class="muted" style="font-size:12px;">Monto devuelto CLP</span>
                      <input id="montoDevueltoCLP" type="number" class="input-field mono" style="max-width:180px;" min="0" step="1000" value="0"/>
                    </div>
                  </div>
                </td>
              </tr>

              <tr>
                <td id="celdaEstadoConstancia">Constancia efectivo USD / transferencia coord</td>
                <td><a id="linkTransferencia" class="link-doc" target="_blank" rel="noopener">PENDIENTE</a></td>
                <td>
                  <div style="display:flex; flex-direction:column; gap:8px;">
                    <label style="display:flex; gap:8px; align-items:center;">
                      <input id="chkTransferenciaOk" type="checkbox"/> Revisado
                    </label>
                    <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
                      <span class="muted" style="font-size:12px;">Monto devuelto USD</span>
                      <input id="montoDevueltoUSD" type="number" class="input-field mono" style="max-width:180px;" min="0" step="0.01" value="0"/>
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- =========================
           IMPRESIÓN
      ========================== -->
      <section class="card" style="margin-bottom:18px;">
        <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
          <h2 style="margin:0; font-size:14px;">Acta de rendición</h2>
          <button id="btnImprimirRendicion" type="button" class="btn btn-primary">Imprimir</button>
        </div>

        <!-- tu JS renderiza acá el HTML del acta -->
        <div id="printActa" style="margin-top:12px;"></div>

        <!-- fallback opcional si todavía ocupas printSheet -->
        <pre id="printSheet" style="display:none;"></pre>
      </section>

    </div>
  </main>

  <!-- ✅ Header común (debe existir este archivo en tu repo) -->
  <script type="module" src="./header-common.js"></script>

  <!-- ✅ Tu lógica de la página -->
  <script type="module" src="./rendiciones_coordinadores.js"></script>
</body>
</html>
