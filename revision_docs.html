<!-- ‚úÖ revision_docs.html (COMPLETO) -->
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Revisi√≥n Contable de Documentos | RT</title>

  <link rel="icon" type="image/png" href="Logo Raitrai.png"/>
  <link rel="stylesheet" href="estilos.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>

  <style>
    /* =====================================================
       üîí AISLAMIENTO DE ESTA P√ÅGINA (para no pelear con estilos.css)
       ===================================================== */
    body { background:#f6f6f6; }

    #revisionDocsRoot{
      max-width:1600px;
      margin:0 auto;
      padding:1.2rem 1.4rem;
    }

    .rd-title{ margin-bottom:1rem; }
    .rd-title h2{ margin:0; }
    .rd-title p{ margin:.25rem 0 0; color:#555; font-size:.9rem; }

    .rd-card{
      background:#fff;
      border:1px solid #ddd;
      border-radius:10px;
      padding:1rem 1.2rem;
      margin-bottom:1rem;
      box-shadow:0 2px 6px rgba(0,0,0,.05);
    }
    .rd-card h3{
      margin:0 0 .75rem;
      font-size:1rem;
      border-bottom:1px solid #eee;
      padding-bottom:.4rem;
      display:flex;
      align-items:center;
      gap:.4rem;
    }

    /* =======================
       GRID FILTROS
       ======================= */
    .rd-filters{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:.75rem;
      align-items:end;
    }
    .rd-field{ display:flex; flex-direction:column; gap:.25rem; }
    .rd-field label{
      font-size:.75rem;
      font-weight:600;
      color:#444;
      text-transform:uppercase;
    }

    .rd-field input, .rd-field select{
      padding:.45rem .5rem;
      border:1px solid #ccc;
      border-radius:6px;
      font-size:.9rem;
      background:#fff;
      width:100%;
      box-sizing:border-box;
      text-transform:none; /* tu css global pone uppercase */
    }

    .col-3{ grid-column: span 3; }
    .col-4{ grid-column: span 4; }
    .col-6{ grid-column: span 6; }
    .col-12{ grid-column: span 12; }

    /* =======================
       MULTISELECT (details)
       ======================= */
    details.multi{
      border:1px solid #ccc;
      border-radius:8px;
      background:#fff;
      padding:.35rem .5rem;
    }
    details.multi summary{
      cursor:pointer;
      list-style:none;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:.5rem;
      font-weight:600;
      font-size:.85rem;
    }
    details.multi summary::-webkit-details-marker{ display:none; }
    .multi-pill{
      font-weight:600;
      color:#004080;
      background:#e7f0ff;
      border:1px solid #b9d4ff;
      padding:.1rem .45rem;
      border-radius:999px;
      font-size:.75rem;
    }
    .multi-panel{
      margin-top:.55rem;
      border-top:1px solid #eee;
      padding-top:.6rem;
      display:flex;
      flex-direction:column;
      gap:.5rem;
    }
    .multi-panel input{
      border:1px solid #ddd;
      border-radius:8px;
      padding:.45rem .55rem;
      width:100%;
    }
    .multi-actions{
      display:flex;
      gap:.5rem;
      flex-wrap:wrap;
    }
    .mini-btn{
      padding:.35rem .6rem;
      border-radius:8px;
      border:1px solid #ddd;
      background:#fff;
      cursor:pointer;
      font-weight:700;
      font-size:.75rem;
    }
    .multi-list{
      max-height:220px;
      overflow:auto;
      border:1px solid #eee;
      border-radius:10px;
      padding:.35rem;
    }
    .multi-list .opt{
      display:flex;
      gap:.5rem;
      align-items:flex-start;
      padding:.35rem .35rem;
      border-radius:8px;
      cursor:pointer;
    }
    .multi-list .opt:hover{ background:#f6f7fb; }
    .multi-list input[type="checkbox"]{
      margin-top:.15rem;
      width:auto;
    }

    /* =======================
       BOTONES
       ======================= */
    .rd-actions{
      display:flex;
      gap:.6rem;
      margin-top:.8rem;
      flex-wrap:wrap;
      align-items:center;
    }
    .rd-btn{
      padding:.55rem 1.1rem;
      border-radius:6px;
      border:1px solid #004080;
      background:#004080;
      color:#fff;
      font-weight:700;
      cursor:pointer;
      font-size:.9rem;
      display:inline-flex;
      align-items:center;
      gap:.4rem;
    }
    .rd-btn.secondary{
      background:#fff;
      color:#004080;
    }
    .rd-btn:disabled{
      opacity:.45;
      cursor:not-allowed;
      filter:grayscale(.2);
    }

    #infoPendientes{
      display:none;
      padding:.35rem .55rem;
      border-radius:999px;
      border:1px solid #f59e0b;
      background:#fff7ed;
      color:#7c2d12;
      font-weight:800;
      font-size:.8rem;
    }

    /* =======================
       TABLA
       ======================= */
    .rd-table-wrap{ overflow-x:auto; }
    table.rd-table{
      width:100%;
      border-collapse:collapse;
      background:#fff;
      /* ‚úÖ para que ‚Äúentren m√°s‚Äù y el grupo no explote */
      table-layout:fixed;
      min-width:1180px;
    }
    table.rd-table th, table.rd-table td{
      border:1px solid #ddd;
      padding:.5rem .6rem;
      font-size:.85rem;
      text-align:left;
      white-space:nowrap;
      vertical-align:top;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    table.rd-table thead th{
      background:#f1f1f1;
      font-size:.75rem;
      text-transform:uppercase;
    }
    .muted{ color:#6b7280; }

    .tag{
      display:inline-block;
      padding:.15rem .45rem;
      border-radius:999px;
      border:1px solid #ddd;
      background:#fff;
      font-size:.75rem;
      font-weight:800;
    }
    .tag.ok{ background:#d1fae5; border-color:#34d399; }
    .tag.pending{ background:#f3f4f6; border-color:#d1d5db; color:#6b7280; }
    .tag.bad{ background:#fee2e2; border-color:#ef4444; color:#991b1b; }

    .link{
      color:#004080;
      font-weight:900;
      cursor:pointer;
      text-decoration:underline;
    }
    .chk{ transform:scale(1.1); }

    /* ‚úÖ Anchos por columna (para que no se desborde) */
    th.col-grupo, td.col-grupo{ width:220px; }         /* m√°s angosto */
    th.col-dest,  td.col-dest{ width:120px; }
    th.col-coord, td.col-coord{ width:180px; }         /* email normalizado */
    th.col-tipo,  td.col-tipo{ width:140px; }
    th.col-rend,  td.col-rend{ width:110px; }
    th.col-aprob, td.col-aprob{ width:140px; }
    th.col-mon,   td.col-mon{ width:80px; }
    th.col-monto, td.col-monto{ width:140px; }
    th.col-arch,  td.col-arch{ width:110px; }
    th.col-fiscal,td.col-fiscal{ width:150px; }
    th.col-rev,   td.col-rev{ width:90px; }

    /* Select fiscal compacto */
    .sel-fiscal{
      width:100%;
      padding:.35rem .45rem;
      border:1px solid #ccc;
      border-radius:8px;
      font-weight:800;
      font-size:.78rem;
      background:#fff;
      text-transform:none;
    }

    /* =======================
       MODAL VISOR
       ======================= */
    #viewerModal{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.55);
      display:none;
      z-index:9999;
      padding:20px;
    }
    #viewerModal.open{ display:flex; align-items:center; justify-content:center; }
    .viewer-card{
      width:min(1100px, 96vw);
      height:min(720px, 90vh);
      background:#fff;
      border-radius:14px;
      overflow:hidden;
      box-shadow:0 12px 40px rgba(0,0,0,.25);
      display:flex;
      flex-direction:column;
    }
    .viewer-head{
      padding:12px 14px;
      border-bottom:1px solid #eee;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .viewer-txt{
      min-width:0;
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    #viewerTitle{ font-weight:900; font-size:.95rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    #viewerSub{ font-size:.8rem; color:#6b7280; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .viewer-actions{
      display:flex;
      gap:10px;
      align-items:center;
      flex-shrink:0;
    }
    #viewerOpenTab{
      padding:.4rem .7rem;
      border-radius:10px;
      border:1px solid #004080;
      color:#004080;
      font-weight:900;
      text-decoration:none;
      white-space:nowrap;
    }
    #viewerClose{
      padding:.4rem .7rem;
      border-radius:10px;
      border:1px solid #ddd;
      background:#fff;
      font-weight:900;
      cursor:pointer;
      white-space:nowrap;
    }
    #viewerBody{
      flex:1;
      background:#0b1329;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:auto;
    }
    #viewerBody iframe{
      width:100%;
      height:100%;
      border:0;
      background:#fff;
    }
    #viewerBody img{
      max-width:100%;
      max-height:100%;
      object-fit:contain;
      background:#fff;
    }

    @media (max-width: 1100px){
      .rd-filters{ grid-template-columns: repeat(6, 1fr); }
      .col-3,.col-4,.col-6{ grid-column: span 6; }
    }
    @media (max-width: 700px){
      .rd-filters{ grid-template-columns: 1fr; }
      .col-3,.col-4,.col-6,.col-12{ grid-column: span 1; }
      table.rd-table{ min-width:unset; }
    }
  </style>
</head>

<body>
  <!-- HEADER GLOBAL -->
  <div id="encabezado"></div>

  <!-- DATALIST DESTINOS -->
  <datalist id="dl-destinos-docs"></datalist>

  <div id="revisionDocsRoot">

    <div class="rd-title">
      <h2>REVISI√ìN CONTABLE DE DOCUMENTOS</h2>
    </div>

    <!-- FILTROS -->
    <div class="rd-card">
      <h3><span class="material-symbols-outlined">tune</span> Filtros</h3>

      <div class="rd-filters">
        <div class="rd-field col-3">
          <label>Destino</label>
          <input id="filtroDestinoDocs" list="dl-destinos-docs" placeholder="Ej: BARILOCHE"/>
        </div>

        <div class="rd-field col-3">
          <label>Coordinadores (multi)</label>
          <details class="multi">
            <summary>
              <span id="multiCoordsLabel">Seleccionar‚Ä¶</span>
              <span class="multi-pill">MULTI</span>
            </summary>
            <div class="multi-panel">
              <input id="searchCoords" placeholder="Buscar coordinador‚Ä¶"/>
              <div class="multi-actions">
                <button type="button" class="mini-btn" id="btnCoordsAll">Todos</button>
                <button type="button" class="mini-btn" id="btnCoordsNone">Ninguno</button>
              </div>
              <div class="multi-list" id="coordsList"></div>
            </div>
          </details>
        </div>

        <div class="rd-field col-3">
          <label>Grupos (multi)</label>
          <details class="multi">
            <summary>
              <span id="multiGruposLabel">Seleccionar‚Ä¶</span>
              <span class="multi-pill">MULTI</span>
            </summary>
            <div class="multi-panel">
              <input id="searchGrupos" placeholder="Buscar grupo‚Ä¶ (n√∫mero o nombre)"/>
              <div class="multi-actions">
                <button type="button" class="mini-btn" id="btnGruposAll">Todos</button>
                <button type="button" class="mini-btn" id="btnGruposNone">Ninguno</button>
              </div>
              <div class="multi-list" id="gruposList"></div>
            </div>
          </details>
        </div>

        <div class="rd-field col-3">
          <label>Tipo documento (multi)</label>
          <details class="multi">
            <summary>
              <span id="multiTiposLabel">Seleccionar‚Ä¶</span>
              <span class="multi-pill">MULTI</span>
            </summary>
            <div class="multi-panel">
              <input id="searchTipos" placeholder="Buscar tipo‚Ä¶"/>
              <div class="multi-actions">
                <button type="button" class="mini-btn" id="btnTiposAll">Todos</button>
                <button type="button" class="mini-btn" id="btnTiposNone">Ninguno</button>
              </div>
              <div class="multi-list" id="tiposList"></div>
            </div>
          </details>
        </div>

        <div class="rd-field col-3">
          <label>Gasto aprobado</label>
          <select id="filtroGastoAprobado">
            <option value="">(TODOS)</option>
            <option value="OK">OK</option>
            <option value="NO">NO</option>
          </select>
        </div>

        <div class="rd-field col-6">
          <label>Texto libre</label>
          <input id="filtroTextoDocs" placeholder="Grupo, destino, coord, tipo, asunto, etc..."/>
        </div>
      </div>

      <div class="rd-actions">
        <button class="rd-btn" id="btnCargarDocs">
          <span class="material-symbols-outlined">search</span>
          Cargar
        </button>

        <button class="rd-btn secondary" id="btnLimpiarDocs">Limpiar</button>

        <button class="rd-btn secondary" id="btnExportDocs">
          <span class="material-symbols-outlined">download</span>
          Exportar Excel
        </button>

        <span id="infoPendientes"></span>

        <button class="rd-btn" id="btnGuardarPendientes" style="margin-left:auto;">
          <span class="material-symbols-outlined">save</span>
          Guardar cambios
        </button>

        <span id="infoDocs" class="muted"></span>
      </div>
    </div>

    <!-- RESULTADOS -->
    <div class="rd-card">
      <h3><span class="material-symbols-outlined">folder_open</span> Resultados</h3>

      <div class="rd-table-wrap">
        <table class="rd-table" id="tblDocs">
          <thead>
            <tr>
              <th class="col-grupo">Grupo</th>
              <th class="col-coord">Coordinador</th>
              <th class="col-tipo">Tipo</th>
              <th class="col-rend">Rendici√≥n</th>
              <th class="col-aprob">Gasto aprobado</th>
              <th class="col-mon">Moneda</th>
              <th class="col-monto">Monto</th>
              <th class="col-arch">Archivo</th>
              <th class="col-fiscal">Documento Fiscal</th>
              <th class="col-rev">Revisado</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td colspan="11" class="muted">Sin documentos para los filtros seleccionados.</td>
            </tr>
          </tbody>
        </table>
      </div>

  </div>

  <!-- MODAL VISOR -->
  <div id="viewerModal" aria-hidden="true">
    <div class="viewer-card">
      <div class="viewer-head">
        <div class="viewer-txt">
          <div id="viewerTitle">Documento</div>
          <div id="viewerSub"></div>
        </div>
        <div class="viewer-actions">
          <a id="viewerOpenTab" href="#" target="_blank" rel="noopener">Abrir pesta√±a</a>
          <button id="viewerClose" type="button">Cerrar</button>
        </div>
      </div>
      <div id="viewerBody"></div>
    </div>
  </div>

  <!-- ‚úÖ XLSX (SheetJS) -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <!-- SCRIPTS -->
  <script type="module">
    (async () => {
      try {
        const html = await (await fetch('encabezado.html')).text();
        document.getElementById('encabezado').innerHTML = html;
      } catch(e){}

      await import('./firebase-init.js');
      await import('./script.js').catch(()=>{});
      await import('./revision_docs.js');
    })();
  </script>
</body>
</html>
