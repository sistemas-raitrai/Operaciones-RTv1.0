<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Mi Viaje | RT</title>

  <!-- Tus estilos globales -->
  <link rel="stylesheet" href="estilos.css" />
  <link rel="icon" type="image/png" href="Logo Raitrai.png" />

  <style>
    /* ========= Base de layout ========= */
    .grid{ display:grid; gap:12px; }
    .card{ border:1px solid #e5e7eb; border-radius:12px; padding:12px; background:#fff; }
    .activity-card{ border:1px solid #e5e7eb; border-radius:12px; padding:12px; background:#fff; }
    .dia-seccion{ margin:12px 0; }
    .dia-titulo{ color:#1D4ED8; font-weight:700; }

    .row{ display:grid; grid-template-columns:1fr auto; gap:12px; align-items:end; }
    .column{ display:block; }
    .btn-add{ margin-left:8px; }
    .readonly-field{ opacity:.9; }

    .table-wrapper{ overflow:auto; }
    table{ width:100%; border-collapse:collapse; }
    th,td{ padding:6px 4px; border-bottom:1px solid #eee; text-align:left; }

    /* Texto plano opcional (si quisieras imprimir texto en bloque) */
    .print-only{
      display:none;
      white-space:pre-wrap;
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif;
    }

    /* En pantalla, oculta el logo de impresi√≥n */
    @media screen{ #print-logo{ display:none; } }

    /* ========= Itinerario embebido y ADAPTABLE (PANTALLA) ========= */
    /* El contenedor que creo por JS antes de la frase ‚ÄúTURISMO RAITRAI...‚Äù */
    .dias-embebidas{
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 12px;
      align-items: start;
      margin: 12px 0;
    }
    /* Asegurar que las columnas-d√≠a no hereden min-width del layout previo */
    .dias-embebidas .dia-seccion{
      margin: 0;
      width: auto !important;
      min-width: 0 !important;
      max-width: none !important;
      flex: 1 1 auto !important; /* por si ven√≠an de un flex horizontal */
    }
    /* Est√©tica del t√≠tulo del d√≠a dentro de la caja */
    .dias-embebidas .dia-titulo{
      background: #eef2ff;
      border-radius: 8px;
      padding: 6px 8px;
      margin-bottom: 8px;
      font-weight: 700;
    }

    /* Ocultar cualquier ‚Äúscrollbar/slider‚Äù horizontal heredado del layout viejo */
    #itinerario-container{
      overflow: visible !important;
    }
    #itinerario-container input[type="range"],
    #itinerario-container .scrollbar,
    #itinerario-container .x-scroll,
    #itinerario-container [data-scrollbar]{
      display: none !important;
    }

    /* Espacio entre t√≠tulos numerados tipo "1. ..." (pantalla y print) */
    .seccion-num{
      display:block;
      margin:22px 0 18px;   /* ‚Üê separa cada bloque */
      font-weight:700;
      line-height:1.25;
    }
    /* Si tus n√∫meros est√°n en una <ol> */
    #itinerario-container .card ol > li + li{
      margin-top:16px;
    }

    /* Responsive fino para pantallas angostas */
    @media (max-width: 840px){
      .dias-embebidas{
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      }
    }

    /* Desactivar carrusel heredado de miviaje.js */
    #itinerario-container { overflow: visible !important; }
    #itinerario-container .x-scroll,
    #itinerario-container .scrollbar,
    #itinerario-container [role="scrollbar"],
    #itinerario-container input[type="range"],
    #itinerario-container .range,
    #itinerario-container .slider,
    #itinerario-container .scroll-track,
    #itinerario-container .scroll-thumb {
      display: none !important;
    }

    /* ========= IMPRESI√ìN ========= */
    @media print{
      @page{ margin:14mm 12mm; }
      *{ -webkit-print-color-adjust:exact; print-color-adjust:exact; }

      header, .btn-add{ display:none !important; }
      .print-only, #print-block{ display:none !important; }

      /* Logo fijo arriba-derecha */
      #print-logo{
        display:block;
        position:fixed;
        top:12px; right:12px;
        width:120px;
      }

      /* Simplificar listados para evitar cortes raros */
      .grid,
      #itinerario-container,
      .activity-list{
        display:block !important;
        gap:0 !important;
        width:100% !important;
      }

      .dia-seccion{ break-inside:avoid; page-break-inside:avoid; margin:12px 0 10px 0 !important; }
      .dia-seccion h3{
        color:#1D4ED8 !important;
        margin:12px 0 6px 0 !important;
        padding:0 !important;
        font-size:12pt !important;
        text-align:left !important;
        background:none !important;
        border:0 !important;
      }

      .activity-card p{
        margin:0 0 4px 0 !important;
        font-size:11pt !important;
        font-weight:600;
      }

      body{ background:#fff; color:#000; font-size:11pt; }
      h1,h2,h3{ margin:0 0 6px 0; }

      /* Apilar bloques del encabezado */
      .row{ display:block !important; margin:0 0 8px 0 !important; }
      .row .column, .row .long, .row .medium, .row .short{
        display:block !important; width:100% !important; margin:0 0 4px 0 !important;
      }
      #itinerario-container{ margin-top:14px !important; }

      /* Helpers de visibilidad */
      .u-hide-screen { display: none !important; }
      @media print { .u-hide-screen { display: block !important; } }
      .u-hide-all { display: none !important; }

      /* Para imprimir, fuerza 3 columnas si cabe la hoja */
      .dias-embebidas{
        grid-template-columns: repeat(3, 1fr) !important;
      }
    }
  </style>
</head>

<body class="itinerario-page">
  <!-- Logo usado solo en impresi√≥n -->
  <img id="print-logo" src="Logo Raitrai.png" alt="RaiTrai" />

  <!-- Encabezado liviano SIN autenticaci√≥n -->
  <header class="header" style="display:flex;align-items:center;gap:.75rem;padding:.5rem 1rem;border-bottom:1px solid #ddd;background:#fff;">
    <img src="Logo Raitrai.png" alt="Rai Trai" style="height:36px;width:auto;">
    <h1 style="font-size:1.25rem;margin:0;">Mi Viaje</h1>

    <!-- Resumen de pax a la derecha -->
    <div id="resumen-pax" style="margin-left:auto;font-size:.9rem;color:#666;"></div>

    <!-- Botones utilitarios (no se muestran al imprimir por CSS) -->
    <button id="btnShare" class="btn-add" title="Copiar enlace para compartir">üîó Copiar enlace</button>
    <button id="btnPrint" class="btn-add" title="Imprimir / Guardar en PDF">üñ®Ô∏è Imprimir</button>
  </header>

  <main class="main" style="padding:12px;">
    <!-- Cabecera de grupo (s√≥lo lectura) ‚Äî OCULTA EN PANTALLA -->
    <div id="cabecera-grupo" style="display:none">
      <div class="row">
        <div class="column long">
          <h2>PROGRAMA: <span id="grupo-title">‚Äì</span></h2>
        </div>
        <div class="column medium">
          <h2>FECHAS: <span id="grupo-fechas" class="readonly-field">‚Äî</span></h2>
        </div>
      </div>
    
      <div class="column medium">
        <h2>GRUPO: <span id="grupo-nombre">‚Äî</span></h2>
      </div>
    
      <!-- Info secundaria -->
      <div class="row" style="grid-template-columns:2fr 1fr;">
        <div class="column medium">
          <label>Destino</label>
          <div id="grupo-destino" class="readonly-field">‚Äî</div>
        </div>
        <div class="column short">
          <label>N¬∞ Negocio</label>
          <div id="grupo-numero" class="readonly-field">‚Äî</div>
        </div>
      </div>
    
      <!-- Placeholder de Ficha del grupo; miviaje.js completa Vuelos y Hoteles -->
      <section id="grupo-ficha" style="margin:12px 0;">
        <h3 style="margin: 12px 0 6px;">Ficha del grupo</h3>
        <div id="ficha-inner" class="grid" style="grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:12px;"></div>
      </section>
    </div>

    <!-- Contenedor visual (tarjetas) -->
    <div id="itinerario-container" class="grid"></div>

    <!-- Contenedor textual S√ìLO para impresi√≥n (si quisieras usarlo) -->
    <pre id="print-block" class="print-only"></pre>
  </main>

  <noscript>
    <p style="padding:1rem;color:#b00;">Esta p√°gina requiere JavaScript para cargar tu viaje.</p>
  </noscript>

  <!-- Visor p√∫blico (sin auth); lee Firestore y rellena todo -->
  <script type="module">
    import './miviaje.js';
  </script>

  <!-- Embebe los ‚Äúd√≠as‚Äù dentro de la caja ANTES de la frase ‚ÄúTURISMO RAITRAI...‚Äù -->
  <script>
    (function(){
      const cont = document.getElementById('itinerario-container');
      if (!cont) return;

      function embutirItinerario(){
        // 1) Encontrar la frase "TURISMO RAITRAI LES DESEA..."
        const deseo = Array.from(cont.querySelectorAll('*'))
          .find(n => n && /TURISMO\s+RAITRAI\s+LES\s+DESEA/i.test(n.textContent || ''));
        if (!deseo) return;

        // 2) La "caja" (card) donde est√° la frase
        const caja = deseo.closest('.card') || deseo.parentElement;
        if (!caja || caja.dataset.itinEmbutido === '1') return; // ya hecho

        // 3) Crear un grid contenedor para los d√≠as y ponerlo ANTES de la frase
        const grid = document.createElement('div');
        grid.className = 'dias-embebidas';
        caja.insertBefore(grid, deseo);

        // 4) Mover **solo** las secciones de d√≠a dentro de la caja
        const dias = Array.from(cont.querySelectorAll('.dia-seccion'));
        if (!dias.length) return;

        dias.forEach(d => grid.appendChild(d));

        // Marcar para no repetir
        caja.dataset.itinEmbutido = '1';
        obs.disconnect();
      }

      // Esperar a que miviaje.js pinte todo
      const obs = new MutationObserver(embutirItinerario);
      obs.observe(cont, { childList: true, subtree: true });
      window.addEventListener('load', embutirItinerario);
    })();
  </script>

  <!-- Marca ‚Äú1. ‚Ä¶‚Äù como secciones espaciadas -->
  <script>
    (function () {
      const cont = document.getElementById('itinerario-container');
      if (!cont) return;

      const RE = /^\s*\d+\.\s/; // ‚Äún. ‚Äù al inicio

      function marcarNumerados(){
        // Recorre todas las cards y marca hijos directos que empiecen con "n. "
        cont.querySelectorAll('.card').forEach(card => {
          Array.from(card.children).forEach(el => {
            if (/^(P|DIV|H\d)$/i.test(el.tagName) && RE.test((el.textContent||'').trim())){
              el.classList.add('seccion-num');
            }
          });
        });
      }

      // Correr cuando miviaje.js termina de pintar
      const obs = new MutationObserver(marcarNumerados);
      obs.observe(cont, { childList:true, subtree:true });
      window.addEventListener('load', marcarNumerados);
    })();
  </script>
  <script>
(function(){
  const cont = document.getElementById('itinerario-container');
  if (!cont) return;

  function desactivarCarrusel(){
    // Quita controles de scroll/slider que haya dejado miviaje.js
    cont.querySelectorAll(
      'input[type="range"], [role="scrollbar"], .scrollbar, .x-scroll, .slider, .scroll-track, .scroll-thumb'
    ).forEach(el => el.remove());

    // Neutraliza wrappers con overflow horizontal
    cont.querySelectorAll('[style*="overflow-x"], .overflow-x, .overflow-auto, .x-overflow')
      .forEach(el => {
        el.style.overflow = 'visible';
        el.style.overflowX = 'visible';
      });
  }

  function embutirItinerario(){
    const deseo = Array.from(cont.querySelectorAll('*'))
      .find(n => n && /TURISMO\s+RAITRAI\s+LES\s+DESEA/i.test(n.textContent || ''));
    if (!deseo) return;

    const caja = deseo.closest('.card') || deseo.parentElement;
    if (!caja || caja.dataset.itinEmbutido === '1') return;

    const grid = document.createElement('div');
    grid.className = 'dias-embebidas';
    caja.insertBefore(grid, deseo);

    const dias = Array.from(cont.querySelectorAll('.dia-seccion'));
    dias.forEach(d => grid.appendChild(d));

    caja.dataset.itinEmbutido = '1';

    desactivarCarrusel();  // <-- IMPORTANTE
    obs.disconnect();
  }

  const obs = new MutationObserver(embutirItinerario);
  obs.observe(cont, { childList: true, subtree: true });
  window.addEventListener('load', () => { embutirItinerario(); desactivarCarrusel(); });
})();
</script>

</body>
</html>
