<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Viajes | Asignaci√≥n y Coordinadores</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Tipograf√≠a/estilos globales del sistema (restaura tu fuente) -->
  <link rel="stylesheet" href="estilos.css" />

  <!-- Flatpickr (datepicker) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

  <style>
    /* ====== Layout general ====== */
    .page { padding: 1rem 1.2rem; }
    h2 { margin: .6rem 0 1rem; }

    .toolbar {
      display:flex; gap:.5rem; margin:.8rem 0 1.2rem; flex-wrap:wrap;
      align-items:center;
    }

    .grid { display:grid; grid-template-columns: 340px 1fr; gap:1rem; align-items:start; }

    /* ====== Contenedores visuales ====== */
    .panel { border:1px solid #ddd; border-radius:10px; background:#fff; }
    .panel > .hd { padding:.6rem .8rem; border-bottom:1px solid #eee; font-weight:600; }
    .panel > .bd { padding:.6rem .8rem; }

    .list { max-height:58vh; overflow:auto; }

    .card {
      border:1px solid #ddd; border-radius:12px; background:#fff; margin:.6rem 0;
      display:block; width:100%;
    }
    .card .hd { padding:.6rem .8rem; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center; gap:.5rem; }
    .card .bd { padding:.6rem .8rem; }

    /* ====== Tipograf√≠a y chips ====== */
    .muted { color:#666; }
    .row { display:flex; gap:.5rem; align-items:center; flex-wrap:wrap; }
    .tag { background:#eef3fa; color:#1f64b2; padding:.1rem .4rem; border-radius:6px; font-size:.85rem; }
    .pill { padding:.06rem .35rem; border-radius:999px; background:#f1f5f9; font-size:.78rem; }
    .warn { color:#c57e00; font-weight:600; }
    .err { color:#b11; font-weight:700; }

    /* ====== Tabla ====== */
    table { width:100%; border-collapse:collapse; }
    th, td { border:1px solid #eee; padding:.4rem .5rem; text-align:left; vertical-align:top; }
    th { background:#f8fafc; }
    input[type="text"] { width:100%; box-sizing:border-box; padding:.35rem .45rem; }
    select, input[type="date"] { padding:.35rem .45rem; }

    /* ====== Botones ====== */
    .btn { background:#1f64b2; color:#fff; border:none; padding:.5rem .8rem; border-radius:6px; cursor:pointer; }
    .btn.secondary { background:#5a6a7a; }
    .btn.ghost { background:#e8eef6; color:#1f64b2; }
    .btn.small { padding:.3rem .55rem; font-size:.9rem; }
    .btn.small.selected-swap{ outline:2px solid #1f64b2; box-shadow:0 0 0 3px #d9e9ff inset; }

    .empty { color:#777; font-style:italic; padding:.4rem 0; }

    /* ====== Modal ====== */
    .modal-backdrop { position:fixed; inset:0; background:rgba(0,0,0,.4); display:none; }
    .modal {
      position:fixed; top:6vh; left:50%; transform:translateX(-50%);
      width:min(980px,96vw); background:#fff; border-radius:12px;
      box-shadow:0 10px 30px rgba(0,0,0,.2); display:none;
    }
    .modal .hd { padding:.8rem 1rem; border-bottom:1px solid #eee; font-weight:700; display:flex; justify-content:space-between; align-items:center; }
    .modal .bd { padding:1rem; max-height:70vh; overflow:auto; }
    .modal .ft { padding:.8rem 1rem; border-top:1px solid #eee; display:flex; justify-content:flex-end; gap:.5rem; }
    .x { cursor:pointer; font-size:1.4rem; line-height:1; }

    /* ====== MAY√öSCULAS + heredar fuente (solo visual) ====== */
    .page, .page * { text-transform: uppercase; }
    .page input, .page select, .page button, .page textarea,
    .page table, .page .card, .page .panel {
      font-family: inherit !important;
      font-size: 100%;
    }
    /* Flatpickr tambi√©n en may√∫scula y con la misma fuente */
    .flatpickr-calendar, .flatpickr-calendar * {
      text-transform: uppercase;
      font-family: inherit !important;
    }
    /* Si algo NO debe ir en may√∫scula, usa la clase no-caps */
    .no-caps, .no-caps * { text-transform: none !important; }
  </style>
</head>
<body>
  <!-- Encabezado global de la app -->
  <div id="encabezado"></div>

  <div class="page">
    <h2>Asignaci√≥n De <b>Viajes</b> Y Coordinadores</h2>

    <!-- Toolbar -->
    <div class="toolbar">
      <button class="btn" id="btn-modal-coords">Gestionar coordinadores</button>
      <button class="btn ghost" id="btn-sugerir">Sugerir grupos de viajes (auto)</button>
      <button class="btn ghost" id="btn-nuevo-conjunto">Nuevo grupo de viajes</button>
      <button class="btn secondary" id="btn-guardar">Guardar cambios</button>
      <span id="msg" class="muted"></span>
    </div>

    <!-- üìä Resumen + Filtros -->
    <div class="panel" style="margin:.8rem 0;">
      <div class="hd">üìä Resumen Y Filtros</div>
      <div class="bd">
        <div class="row" style="gap:.5rem; flex-wrap:wrap; align-items:center;">
          <select id="f-destino"><option>Todos los destinos</option></select>
          <select id="f-programa"><option>Todos los programas</option></select>
          <input type="date" id="f-desde" title="Desde (fecha de inicio)" placeholder="dd-mm-aaaa">
          <input type="date" id="f-hasta" title="Hasta (fecha de inicio)" placeholder="dd-mm-aaaa">
          <input type="text" id="f-buscar" placeholder="Buscar‚Ä¶ separa con comas (colegio,par√≠s,2025)" style="min-width:260px">
        </div>
        <div id="resumen-wrap" style="margin-top:.8rem;"></div>
      </div>
    </div>

    <!-- Cuerpo: Viajes libres + Viajes (asignados) -->
    <div class="grid">
      <div class="panel">
        <div class="hd">üß≥ Viajes Libres</div>
        <div class="bd list">
          <div id="lista-viajes-libres" class="empty">Sin datos‚Ä¶</div>
        </div>
      </div>

      <div class="panel">
        <div class="hd">üóÇÔ∏è Viajes</div>
        <div class="bd" id="conjuntos-wrap">
          <div class="empty">A√∫n no hay grupos de viajes. Usa ‚ÄúSugerir grupos de viajes (auto)‚Äù o ‚ÄúNuevo grupo de viajes‚Äù.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== MODAL: Gestionar coordinadores ===== -->
  <div id="mb" class="modal-backdrop"></div>
  <div id="modal-coords" class="modal" role="dialog" aria-modal="true">
    <div class="hd">
      <div>Gestionar Coordinadores</div>
      <div class="x" id="close-modal">√ó</div>
    </div>

    <div class="bd">
      <div class="row" style="justify-content:space-between;">
        <div class="row">
          <button class="btn small" id="btn-add-coord">+ Agregar</button>
          <button class="btn small" id="btn-add-lote">+ Agregar por Excel</button>
          <input type="file" id="input-excel" accept=".xlsx,.xls" style="display:none;">
        </div>
        <div class="muted">Nombre es obligatorio. Disponibilidad (rangos) es opcional.</div>
      </div>

      <table id="tabla-coords" style="margin-top:.6rem;">
        <thead>
          <tr>
            <th>Nombre *</th>
            <th>RUT</th>
            <th>Tel√©fono</th>
            <th>Correo</th>
            <th>Disponibilidad</th>
            <th>Acci√≥n</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div class="empty muted" id="hint-empty-coords" style="display:none; margin-top:.6rem;">
        No hay coordinadores a√∫n. Agrega manual o carga un Excel con columna <b>Nombre</b>.
      </div>
    </div>

    <div class="ft">
      <button class="btn secondary" id="btn-guardar-coords">Guardar coordinadores</button>
      <button class="btn ghost" id="btn-cerrar">Cerrar</button>
    </div>
  </div>
  <!-- ===== /MODAL ===== -->

  <!-- Dependencias -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <!-- Encabezado global -->
  <script type="module">
    fetch('encabezado.html')
      .then(r => r.text())
      .then(html => { document.getElementById('encabezado').innerHTML = html; });
  </script>

  <!-- Firebase init + l√≥gica de la p√°gina -->
  <script type="module" src="./firebase-init.js"></script>
  <script type="module" src="./coordinadores.js"></script>
</body>
</html>
